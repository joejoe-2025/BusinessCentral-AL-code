tableextension 50171 SalesInvLineExt extends "Sales Invoice Line"
{
    fields
    {
        field(50316; "BZ Tariff Code"; Code[50]) { Caption = 'Tariff Code'; }
        field(50314; "DC DUTY%2"; Decimal) { Caption = 'DUTY%2(Export)'; DecimalPlaces = 0 : 5; }
        field(50315; "AY Duty_Amt2"; Decimal) { Caption = 'Duty Amount2(Based on AV)'; DecimalPlaces = 0 : 2; }
    }
}
codeunit 50172 PostToInvoice_DutySnapshot
{
    // åœ¨â€œå°†è¦å†™å…¥ Sales Invoice Lineâ€æ—¶ï¼ŒæŠŠå½“æ—¶çš„ Tariff/Duty%2/Dutyé‡‘é¢å†™åˆ° Rec ä¸Š
    [EventSubscriber(ObjectType::Table, Database::"Sales Invoice Line", 'OnBeforeInsertEvent', '', true, true)]
    local procedure SIL_OnBeforeInsert(var Rec: Record "Sales Invoice Line"; RunTrigger: Boolean)
    var
        ItemRec: Record Item;
        pct: Decimal;
    begin
        if Rec.Type <> Rec.Type::Item then
            exit;

        // ä»¥â€œå½“å‰ Item çš„å€¼â€ä½œä¸ºå†å²å¿«ç…§ï¼ˆä¹Ÿå¯æ”¹æˆä»æ¥æº Sales Line å–ï¼Œè§ä¸‹æ–¹è¯´æ˜ï¼‰
        if ItemRec.Get(Rec."No.") then begin
            Rec."BZ Tariff Code" := ItemRec."BZ Tariff Code";
            Rec."DC DUTY%2" := ItemRec."DC DUTY%2";
        end else begin
            Rec."BZ Tariff Code" := '';
            Rec."DC DUTY%2" := 0;
        end;

        pct := Rec."DC DUTY%2";

        // è®¡ç®—é‡‘é¢ï¼šä»¥è¡Œé‡‘é¢ä¸ºåŸºæ•°ï¼›è‹¥è¦å«ç¨åŸºæ•°ï¼Œæ¢æˆ Rec."Amount Including VAT"
        Rec."AY Duty_Amt2" := Round(Rec."Line Amount" * pct / 100, 0.01, '=');

        // å…³é”®ç‚¹ï¼šè¿™é‡Œä¸éœ€è¦ Rec.Modify()ï¼Œç³»ç»Ÿéšåä¼šæŠŠ Rec æ’å…¥åˆ°è¡¨ 113
    end;
}


pageextension 50171 PostedSalesInvoiceLineExt extends "Posted Sales Invoice Subform"
{
    layout
    {
        addafter("Line Amount")
        {
            field("BZ Tariff Code"; Rec."BZ Tariff Code")
            {
                Caption = 'ğŸ”´Tafiff Code';
                ApplicationArea = All;
            }
            field("DC DUTY%2"; Rec."DC DUTY%2")
            {
                ApplicationArea = All;
            }
            field("AY Duty_Amt2"; Rec."AY Duty_Amt2")
            {
                ApplicationArea = All;
                Editable = false;
            }
        }
    }
}
