tableextension 50172 PurchInvLineExt extends "Purch. Inv. Line"
{
    fields
    {
        field(50316; "BZ Tariff Code"; Code[50])
        {
            Caption = 'Tariff Code';
        }
        field(50318; "AX Duty%1"; Decimal)
        {
            Caption = 'DUTY%1 (Import)';
            DecimalPlaces = 0 : 5;
        }
        field(50315; "AY Duty_Amt1"; Decimal)
        {
            Caption = 'Duty Amount1 (Based on AV)';
            DecimalPlaces = 0 : 2;
        }
    }
}

codeunit 50192 PurchInvLine_DutySnapshot
{
    // åœ¨â€œå°†è¦å†™å…¥ Purch. Inv. Lineâ€æ—¶ï¼ŒæŠŠå½“æ—¶çš„ Tariff/Duty%1/Dutyé‡‘é¢å†™åˆ° Rec ä¸Š
    [EventSubscriber(ObjectType::Table, Database::"Purch. Inv. Line", 'OnBeforeInsertEvent', '', true, true)]
    local procedure PIL_OnBeforeInsert(var Rec: Record "Purch. Inv. Line"; RunTrigger: Boolean)
    var
        ItemRec: Record Item;
        pct: Decimal;
    begin
        if Rec.Type <> Rec.Type::Item then
            exit;

        // ä»¥â€œå½“å‰ Item çš„å€¼â€ä½œä¸ºå†å²å¿«ç…§ï¼ˆå®Œå…¨å¯¹é½ä½ ç»™çš„ Sales æ¨¡æ¿æ€è·¯ï¼‰
        if ItemRec.Get(Rec."No.") then begin
            Rec."BZ Tariff Code" := ItemRec."BZ Tariff Code";
            Rec."AX Duty%1" := ItemRec."AX Duty%1";
        end else begin
            Rec."BZ Tariff Code" := '';
            Rec."AX Duty%1" := 0;
        end;

        pct := Rec."AX Duty%1";

        // è®¡ç®—é‡‘é¢ï¼šä»¥è¡Œé‡‘é¢ä¸ºåŸºæ•°ï¼›è‹¥è¦å«ç¨åŸºæ•°ï¼Œæ¢æˆ Rec."Amount Including VAT"
        Rec."AY Duty_Amt1" := Round(Rec."Line Amount" * pct / 100, 0.01, '=');

        // å…³é”®ç‚¹ï¼šè¿™é‡Œä¸éœ€è¦ Rec.Modify()ï¼Œç³»ç»Ÿéšåä¼šæŠŠ Rec æ’å…¥åˆ°è¡¨ 123
    end;
}


pageextension 50172 PostedPurchInvLineExt extends "Posted Purch. Invoice Subform"
{
    layout
    {
        addafter("Line Amount")
        {
            field("BZ Tariff Code"; Rec."BZ Tariff Code")
            {
                Caption = 'ğŸ”´ Tariff Code';
                ApplicationArea = All;
            }
            field("AX Duty%1"; Rec."AX Duty%1")
            {
                Caption = 'ğŸ”´ Duty%1 (Import)';
                ApplicationArea = All;
                Editable = false;
            }
            field("AY Duty_Amt1"; Rec."AY Duty_Amt1")
            {
                Caption = 'ğŸ”´ Duty Amount1';
                ApplicationArea = All;
                Editable = false;
            }
        }
    }
}
